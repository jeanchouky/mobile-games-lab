<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no">
<title>Orbit</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body{width:100%;height:100%;overflow:hidden;background:#050510;font-family:-apple-system,system-ui,sans-serif;touch-action:none;user-select:none}
canvas{display:block}
#hud{position:fixed;top:0;left:0;width:100%;padding:12px 16px;display:flex;justify-content:space-between;align-items:center;z-index:10;pointer-events:none}
#hud>div{color:rgba(255,255,255,0.7);font-size:0.85rem;font-weight:600}
#level-text{color:#7ec8e3;font-weight:800;font-size:1rem}
#sats-left{color:#ffd700}
#hint{position:fixed;bottom:16px;left:0;width:100%;text-align:center;color:rgba(255,255,255,0.25);font-size:0.7rem;z-index:10;pointer-events:none}
.overlay{position:fixed;top:0;left:0;width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:rgba(5,5,16,0.95);z-index:20}
.overlay h1{font-size:clamp(2.5rem,8vw,4rem);font-weight:900;color:#7ec8e3;margin-bottom:8px;letter-spacing:-2px}
.overlay .sub{color:#667;margin-bottom:24px;font-size:0.9rem;max-width:300px;text-align:center;line-height:1.5}
.btn{background:linear-gradient(135deg,#1a3a5a,#2a5a8a);border:1px solid rgba(126,200,227,0.3);color:#7ec8e3;font-weight:800;font-size:1rem;padding:14px 36px;border-radius:50px;cursor:pointer;margin:6px;letter-spacing:1px}
.btn:active{transform:scale(0.95)}
.result{color:#fff;font-size:1.3rem;font-weight:700;margin:12px 0}
.stars{color:#ffd700;font-size:2rem;margin:8px 0}
.hidden{display:none!important}
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hud" class="hidden">
  <div id="level-text">Level 1</div>
  <div id="sats-left">Satellites: 3</div>
</div>
<div id="hint"></div>

<div class="overlay" id="menu">
  <h1>ORBIT</h1>
  <div class="sub">Tap to launch satellites into orbit around planets. Find stable orbits to complete each level.<br><br><b>How to play:</b> Tap near a planet to launch a satellite. Gravity pulls it — aim for a stable orbit that lasts 3 seconds.</div>
  <button class="btn" onclick="startLevel(1)">LAUNCH</button>
  <button class="btn" style="background:rgba(255,255,255,0.08);border-color:rgba(255,215,0,0.3);color:#ffd700" onclick="startSandbox()">SANDBOX</button>
  <div style="color:#556;font-size:0.7rem;margin-top:12px">Sandbox: place planets freely and experiment</div>
</div>

<div class="overlay hidden" id="level-complete">
  <div class="result" id="lc-text">Level Complete!</div>
  <div class="stars" id="lc-stars">★★★</div>
  <div class="sub" id="lc-detail"></div>
  <button class="btn" id="next-btn">NEXT LEVEL</button>
  <button class="btn" style="background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.1)" onclick="showMenu()">MENU</button>
</div>

<div class="overlay hidden" id="fail-screen">
  <div class="result" style="color:#e94560">Satellites Lost</div>
  <div class="sub" id="fail-detail">They drifted into the void...</div>
  <button class="btn" id="retry-btn">RETRY</button>
  <button class="btn" style="background:rgba(255,255,255,0.05);border-color:rgba(255,255,255,0.1)" onclick="showMenu()">MENU</button>
</div>

<script>
const canvas=document.getElementById('c'),ctx=canvas.getContext('2d');
let W,H;
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight}
window.addEventListener('resize',resize);resize();

let audioCtx;
function ensureAudio(){
  if(!audioCtx){try{audioCtx=new(window.AudioContext||window.webkitAudioContext)()}catch(e){}}
  if(audioCtx&&audioCtx.state==='suspended')audioCtx.resume().catch(()=>{});
}
function playTone(f,d=0.2,t='sine',v=0.06){
  if(!audioCtx)return;const o=audioCtx.createOscillator(),g=audioCtx.createGain();
  o.type=t;o.frequency.value=f;g.gain.setValueAtTime(v,audioCtx.currentTime);
  g.gain.exponentialRampToValueAtTime(0.001,audioCtx.currentTime+d);
  o.connect(g);g.connect(audioCtx.destination);o.start();o.stop(audioCtx.currentTime+d);
}

const G=0.5;
let planets,satellites,blackHoles,asteroids;
let level,satsToLaunch,satsInOrbit,totalSats,gameActive,launchMode;
let stars=[];
let particles=[];
let checkTimer=0; // seconds for fail check
let lastFrameTime=0;
let sandboxMode=false;
let showPrediction=true;

for(let i=0;i<200;i++)stars.push({x:Math.random(),y:Math.random(),s:Math.random()*1.5+0.5,b:Math.random()});

const LEVELS=[
  null,
  {planets:[{x:0.5,y:0.5,r:25,m:800,color:'#4a9eff'}],sats:3,blackHoles:[],asteroids:[],hint:'Tap near the planet to launch into orbit'},
  {planets:[{x:0.35,y:0.5,r:22,m:600,color:'#ff6b6b'},{x:0.65,y:0.5,r:20,m:500,color:'#4ecdc4'}],sats:3,blackHoles:[],asteroids:[],hint:'Two planets — try orbiting each one'},
  {planets:[{x:0.5,y:0.4,r:30,m:1000,color:'#ffd700'}],sats:4,blackHoles:[],asteroids:[{x:0.3,y:0.65,r:10},{x:0.7,y:0.3,r:10}],hint:'Watch out for asteroids!'},
  {planets:[{x:0.3,y:0.35,r:20,m:500,color:'#a55eea'},{x:0.7,y:0.65,r:20,m:500,color:'#ff9ff3'}],sats:4,blackHoles:[],asteroids:[],hint:'Try a figure-8 orbit between both planets'},
  {planets:[{x:0.5,y:0.5,r:28,m:900,color:'#00cec9'}],sats:3,blackHoles:[{x:0.2,y:0.2,r:15,m:400}],asteroids:[],hint:'Black holes pull hard — stay clear!'},
  {planets:[{x:0.35,y:0.4,r:18,m:400,color:'#e17055'},{x:0.65,y:0.4,r:18,m:400,color:'#00b894'},{x:0.5,y:0.7,r:22,m:600,color:'#fdcb6e'}],sats:5,blackHoles:[],asteroids:[]},
  {planets:[{x:0.5,y:0.45,r:35,m:1200,color:'#6c5ce7'}],sats:4,blackHoles:[{x:0.15,y:0.8,r:12,m:300},{x:0.85,y:0.2,r:12,m:300}],asteroids:[{x:0.3,y:0.2,r:8},{x:0.7,y:0.7,r:8}]},
  {planets:[{x:0.25,y:0.3,r:15,m:300,color:'#ff6348'},{x:0.75,y:0.3,r:15,m:300,color:'#2ed573'},{x:0.25,y:0.7,r:15,m:300,color:'#1e90ff'},{x:0.75,y:0.7,r:15,m:300,color:'#a55eea'}],sats:6,blackHoles:[{x:0.5,y:0.5,r:10,m:200}],asteroids:[]},
];

function showMenu(){
  document.getElementById('menu').classList.remove('hidden');
  document.getElementById('level-complete').classList.add('hidden');
  document.getElementById('fail-screen').classList.add('hidden');
  document.getElementById('hud').classList.add('hidden');
  document.getElementById('hint').textContent='';
  gameActive=false;
}

function startLevel(n){
  ensureAudio();
  if(n>LEVELS.length-1){showMenu();return}
  level=n;
  document.getElementById('menu').classList.add('hidden');
  document.getElementById('level-complete').classList.add('hidden');
  document.getElementById('fail-screen').classList.add('hidden');
  document.getElementById('hud').classList.remove('hidden');
  
  const L=LEVELS[level];
  planets=L.planets.map(p=>({x:p.x*W,y:p.y*H,r:p.r,m:p.m,color:p.color,pulse:0}));
  blackHoles=(L.blackHoles||[]).map(b=>({x:b.x*W,y:b.y*H,r:b.r,m:b.m,angle:0}));
  asteroids=(L.asteroids||[]).map(a=>({x:a.x*W,y:a.y*H,r:a.r}));
  
  satellites=[];particles=[];
  totalSats=L.sats;satsToLaunch=L.sats;satsInOrbit=0;
  gameActive=true;launchMode=true;checkTimer=0;
  
  document.getElementById('level-text').textContent=`Level ${level}`;
  document.getElementById('hint').textContent=L.hint||'';
  updateHud();
}

function updateHud(){
  document.getElementById('sats-left').textContent=
    launchMode?`Tap to launch (${satsToLaunch} left)`:
    `Orbiting: ${satsInOrbit}/${totalSats}`;
}

canvas.addEventListener('touchstart',e=>{e.preventDefault();handleTap(e.touches[0].clientX,e.touches[0].clientY)},{passive:false});
canvas.addEventListener('click',e=>handleTap(e.clientX,e.clientY));

function handleTap(tx,ty){
  if(!gameActive||!launchMode||satsToLaunch<=0)return;
  
  for(const p of planets)if(dist(tx,ty,p.x,p.y)<p.r+20)return;
  for(const b of blackHoles)if(dist(tx,ty,b.x,b.y)<b.r+20)return;
  
  let nearest=planets[0],nd=Infinity;
  for(const p of planets){const d=dist(tx,ty,p.x,p.y);if(d<nd){nd=d;nearest=p}}
  
  const dx=tx-nearest.x,dy=ty-nearest.y;
  const d=Math.sqrt(dx*dx+dy*dy);
  const orbV=Math.sqrt(G*nearest.m/d)*0.7;
  const vx=-dy/d*orbV,vy=dx/d*orbV;
  
  satellites.push({x:tx,y:ty,vx,vy,trail:[],orbitTime:0,stable:false,dead:false});
  satsToLaunch--;
  if(satsToLaunch===0){launchMode=false;checkTimer=0}
  
  playTone(440+Math.random()*200,0.3,'sine',0.05);
  // Clear hint after first launch
  document.getElementById('hint').textContent='';
  updateHud();
}

function dist(x1,y1,x2,y2){return Math.sqrt((x1-x2)**2+(y1-y2)**2)}

function tick(dt){
  if(!gameActive)return;
  // Use fixed time step for physics stability (60fps equivalent)
  const steps=Math.max(1,Math.round(dt/0.016));
  const stepDt=dt/steps;

  for(let step=0;step<steps;step++){
    for(let s of satellites){
      if(s.dead)continue;

      let ax=0,ay=0;
      for(const p of planets){
        const dx=p.x-s.x,dy=p.y-s.y;
        const d=Math.max(dist(s.x,s.y,p.x,p.y),p.r);
        const f=G*p.m/(d*d);
        ax+=f*dx/d;ay+=f*dy/d;
        if(dist(s.x,s.y,p.x,p.y)<p.r){s.dead=true;addExplosion(s.x,s.y,p.color)}
      }
      for(const b of blackHoles){
        const dx=b.x-s.x,dy=b.y-s.y;
        const d=Math.max(dist(s.x,s.y,b.x,b.y),5);
        const f=G*b.m/(d*d);
        ax+=f*dx/d;ay+=f*dy/d;
        if(dist(s.x,s.y,b.x,b.y)<b.r){s.dead=true;addExplosion(s.x,s.y,'#8b00ff')}
      }
      for(const a of asteroids){
        if(dist(s.x,s.y,a.x,a.y)<a.r+4){s.dead=true;addExplosion(s.x,s.y,'#888')}
      }

      s.vx+=ax*stepDt*60;s.vy+=ay*stepDt*60;
      s.x+=s.vx*stepDt*60;s.y+=s.vy*stepDt*60;

      if(s.x<-200||s.x>W+200||s.y<-200||s.y>H+200){s.dead=true}
    }
  }

  // Trail and orbit time (once per frame, not per physics step)
  for(let s of satellites){
    if(s.dead)continue;
    s.trail.push({x:s.x,y:s.y});
    if(s.trail.length>200)s.trail.shift();

    let nearPlanet=false;
    for(const p of planets){
      const d=dist(s.x,s.y,p.x,p.y);
      if(d<p.r*6&&d>p.r*1.2)nearPlanet=true;
    }
    if(nearPlanet)s.orbitTime+=dt;else s.orbitTime=Math.max(0,s.orbitTime-dt*2);
    if(s.orbitTime>3&&!s.stable){
      s.stable=true;satsInOrbit++;
      playTone(523,0.3,'sine',0.08);setTimeout(()=>playTone(659,0.3,'sine',0.08),150);
      for(let i=0;i<20;i++){
        const a=Math.random()*Math.PI*2,sp=1+Math.random()*3;
        particles.push({x:s.x,y:s.y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:1,color:'#ffd700',size:2+Math.random()*3});
      }
      updateHud();
    }
  }

  // Win check
  if(!sandboxMode&&satsInOrbit>=totalSats){
    gameActive=false;
    setTimeout(()=>levelComplete(),500);
    return;
  }

  // Fail check: time-based, not frame-count based
  if(!launchMode&&!sandboxMode){
    checkTimer+=dt;
    if(checkTimer>2){
      const alive=satellites.filter(s=>!s.dead);
      const canStillWin=alive.filter(s=>!s.stable).length+satsInOrbit>=totalSats;
      if(!canStillWin){
        gameActive=false;
        const survived=satsInOrbit;
        document.getElementById('fail-detail').textContent=
          survived>0?`${survived}/${totalSats} satellites made it...`:'They all drifted into the void...';
        setTimeout(()=>{document.getElementById('fail-screen').classList.remove('hidden')},400);
        document.getElementById('retry-btn').onclick=()=>startLevel(level);
      }
    }
  }

  for(const b of blackHoles)b.angle+=dt*1.2;
}

function predictOrbit(tx,ty){
  if(!showPrediction||!launchMode)return[];
  for(const p of planets)if(dist(tx,ty,p.x,p.y)<p.r+20)return[];
  for(const b of blackHoles)if(dist(tx,ty,b.x,b.y)<b.r+20)return[];

  let nearest=planets[0],nd=Infinity;
  for(const p of planets){const d=dist(tx,ty,p.x,p.y);if(d<nd){nd=d;nearest=p}}

  const dx=tx-nearest.x,dy=ty-nearest.y;
  const d=Math.sqrt(dx*dx+dy*dy);
  const orbV=Math.sqrt(G*nearest.m/d)*0.7;
  let sx=tx,sy=ty,svx=-dy/d*orbV,svy=dx/d*orbV;
  const points=[];
  for(let i=0;i<120;i++){
    let ax=0,ay=0;
    for(const p of planets){
      const pdx=p.x-sx,pdy=p.y-sy;
      const pd=Math.max(dist(sx,sy,p.x,p.y),p.r);
      const f=G*p.m/(pd*pd);
      ax+=f*pdx/pd;ay+=f*pdy/pd;
      if(dist(sx,sy,p.x,p.y)<p.r)return points;
    }
    for(const b of blackHoles){
      const bdx=b.x-sx,bdy=b.y-sy;
      const bd=Math.max(dist(sx,sy,b.x,b.y),5);
      const f=G*b.m/(bd*bd);
      ax+=f*bdx/bd;ay+=f*bdy/bd;
    }
    svx+=ax;svy+=ay;sx+=svx;sy+=svy;
    points.push({x:sx,y:sy});
    if(sx<-100||sx>W+100||sy<-100||sy>H+100)break;
  }
  return points;
}

function startSandbox(){
  ensureAudio();
  sandboxMode=true;
  document.getElementById('menu').classList.add('hidden');
  document.getElementById('level-complete').classList.add('hidden');
  document.getElementById('fail-screen').classList.add('hidden');
  document.getElementById('hud').classList.remove('hidden');
  planets=[{x:W/2,y:H/2,r:25,m:800,color:'#4a9eff',pulse:0}];
  blackHoles=[];asteroids=[];satellites=[];particles=[];
  totalSats=999;satsToLaunch=999;satsInOrbit=0;
  gameActive=true;launchMode=true;checkTimer=0;
  document.getElementById('level-text').textContent='Sandbox';
  document.getElementById('hint').textContent='Tap to launch. Double-tap empty space to add a planet.';
  updateHud();
}

let lastTapTime=0;
canvas.addEventListener('dblclick',e=>{
  if(!sandboxMode||!gameActive)return;
  const tx=e.clientX,ty=e.clientY;
  for(const p of planets)if(dist(tx,ty,p.x,p.y)<p.r+30)return;
  const colors=['#ff6b6b','#ffd700','#4ecdc4','#a55eea','#ff9ff3','#00cec9'];
  planets.push({x:tx,y:ty,r:20+Math.random()*10,m:400+Math.random()*400,color:colors[Math.floor(Math.random()*colors.length)],pulse:0});
  playTone(330,0.2,'sine',0.05);
});

function addExplosion(x,y,color){
  for(let i=0;i<20;i++){
    const a=Math.random()*Math.PI*2,sp=1+Math.random()*3;
    particles.push({x,y,vx:Math.cos(a)*sp,vy:Math.sin(a)*sp,life:1,color,size:2+Math.random()*3});
  }
  playTone(100+Math.random()*100,0.3,'sawtooth',0.04);
}

function levelComplete(){
  try{
    const maxLevel=parseInt(localStorage.getItem('orbit_level'))||0;
    if(level>maxLevel)localStorage.setItem('orbit_level',level);
  }catch(e){}
  
  const dead=satellites.filter(s=>s.dead).length;
  const starCount=dead===0?3:dead<=1?2:1;
  
  document.getElementById('lc-text').textContent=`Level ${level} Complete!`;
  document.getElementById('lc-stars').textContent='★'.repeat(starCount)+'☆'.repeat(3-starCount);
  document.getElementById('lc-detail').textContent=dead===0?'All satellites in stable orbit!':
    `${dead} satellite${dead>1?'s':''} lost`;
  document.getElementById('level-complete').classList.remove('hidden');
  document.getElementById('next-btn').onclick=()=>startLevel(level+1);
  
  playTone(523,0.15);setTimeout(()=>playTone(659,0.15),100);setTimeout(()=>playTone(784,0.2),200);
}

let mousePos=null;
canvas.addEventListener('mousemove',e=>{mousePos={x:e.clientX,y:e.clientY}});
canvas.addEventListener('mouseleave',()=>{mousePos=null});
canvas.addEventListener('touchmove',e=>{if(e.touches.length)mousePos={x:e.touches[0].clientX,y:e.touches[0].clientY}},{passive:true});

function draw(timestamp){
  requestAnimationFrame(draw);
  if(!lastFrameTime)lastFrameTime=timestamp;
  const dt=Math.min((timestamp-lastFrameTime)/1000,0.1);
  lastFrameTime=timestamp;

  ctx.fillStyle='rgba(5,5,16,0.25)';ctx.fillRect(0,0,W,H);

  for(const s of stars){
    s.b+=dt*0.3;
    ctx.fillStyle=`rgba(255,255,255,${0.3+Math.sin(s.b)*0.2})`;
    ctx.beginPath();ctx.arc(s.x*W,s.y*H,s.s,0,Math.PI*2);ctx.fill();
  }

  tick(dt);
  
  // Orbital guide rings around planets (subtle)
  if(gameActive&&launchMode){
    for(const p of planets){
      for(let r=2;r<=5;r++){
        ctx.strokeStyle=`rgba(126,200,227,${0.03})`;ctx.lineWidth=1;
        ctx.beginPath();ctx.arc(p.x,p.y,p.r*r,0,Math.PI*2);ctx.stroke();
      }
    }
  }
  
  // Asteroids
  for(const a of asteroids){
    ctx.fillStyle='#555';ctx.beginPath();ctx.arc(a.x,a.y,a.r,0,Math.PI*2);ctx.fill();
    ctx.strokeStyle='#777';ctx.lineWidth=1;ctx.stroke();
  }
  
  // Black holes
  for(const b of blackHoles){
    ctx.save();ctx.translate(b.x,b.y);ctx.rotate(b.angle);
    const grad=ctx.createRadialGradient(0,0,0,0,0,b.r*3);
    grad.addColorStop(0,'rgba(139,0,255,0.3)');grad.addColorStop(0.5,'rgba(139,0,255,0.05)');grad.addColorStop(1,'transparent');
    ctx.fillStyle=grad;ctx.beginPath();ctx.arc(0,0,b.r*3,0,Math.PI*2);ctx.fill();
    ctx.fillStyle='#000';ctx.beginPath();ctx.arc(0,0,b.r,0,Math.PI*2);ctx.fill();
    ctx.strokeStyle='#8b00ff';ctx.lineWidth=2;ctx.beginPath();ctx.arc(0,0,b.r+2,0,Math.PI*2);ctx.stroke();
    // Swirl arms
    for(let i=0;i<3;i++){
      const a=b.angle+i*Math.PI*2/3;
      ctx.strokeStyle='rgba(139,0,255,0.15)';ctx.lineWidth=1.5;
      ctx.beginPath();
      for(let t=0;t<40;t++){
        const r=b.r+2+t*1.5;
        const angle=a+t*0.15;
        const px=Math.cos(angle)*r,py=Math.sin(angle)*r;
        t===0?ctx.moveTo(px,py):ctx.lineTo(px,py);
      }
      ctx.stroke();
    }
    ctx.restore();
  }
  
  // Orbit prediction line
  if(mousePos&&gameActive&&launchMode){
    const predPts=predictOrbit(mousePos.x,mousePos.y);
    if(predPts.length>1){
      for(let i=1;i<predPts.length;i++){
        const alpha=0.15*(1-i/predPts.length);
        ctx.strokeStyle=`rgba(126,200,227,${alpha})`;ctx.lineWidth=1;
        ctx.beginPath();ctx.moveTo(predPts[i-1].x,predPts[i-1].y);ctx.lineTo(predPts[i].x,predPts[i].y);ctx.stroke();
      }
    }
  }

  // Planets
  for(const p of planets){
    p.pulse=(p.pulse+dt*1.2)%(Math.PI*2);
    const grad=ctx.createRadialGradient(p.x,p.y,p.r*0.8,p.x,p.y,p.r*2);
    grad.addColorStop(0,p.color+'40');grad.addColorStop(1,'transparent');
    ctx.fillStyle=grad;ctx.beginPath();ctx.arc(p.x,p.y,p.r*2,0,Math.PI*2);ctx.fill();
    ctx.fillStyle=p.color;ctx.shadowBlur=20;ctx.shadowColor=p.color;
    ctx.beginPath();ctx.arc(p.x,p.y,p.r,0,Math.PI*2);ctx.fill();
    ctx.shadowBlur=0;
    ctx.fillStyle='rgba(255,255,255,0.15)';
    ctx.beginPath();ctx.arc(p.x-p.r*0.3,p.y-p.r*0.3,p.r*0.4,0,Math.PI*2);ctx.fill();
  }
  
  // Satellite trails and bodies
  for(const s of satellites){
    if(s.dead)continue;
    if(s.trail.length>1){
      for(let i=1;i<s.trail.length;i++){
        const alpha=(i/s.trail.length)*(s.stable?0.4:0.2);
        ctx.strokeStyle=s.stable?`rgba(255,215,0,${alpha})`:`rgba(126,200,227,${alpha})`;
        ctx.lineWidth=s.stable?2:1.5;
        ctx.beginPath();ctx.moveTo(s.trail[i-1].x,s.trail[i-1].y);ctx.lineTo(s.trail[i].x,s.trail[i].y);ctx.stroke();
      }
    }
    const color=s.stable?'#ffd700':'#7ec8e3';
    ctx.fillStyle=color;ctx.shadowBlur=12;ctx.shadowColor=color;
    ctx.beginPath();ctx.arc(s.x,s.y,5,0,Math.PI*2);ctx.fill();
    ctx.shadowBlur=0;
    if(s.stable){
      ctx.strokeStyle='rgba(255,215,0,0.5)';ctx.lineWidth=1;
      ctx.beginPath();ctx.arc(s.x,s.y,10+Math.sin(Date.now()/300)*3,0,Math.PI*2);ctx.stroke();
    }
    // Orbit progress indicator
    if(!s.stable&&s.orbitTime>0){
      const prog=Math.min(s.orbitTime/180,1);
      ctx.strokeStyle=`rgba(255,215,0,${0.3+prog*0.4})`;ctx.lineWidth=2;
      ctx.beginPath();ctx.arc(s.x,s.y,9,-Math.PI/2,-Math.PI/2+prog*Math.PI*2);ctx.stroke();
    }
  }
  
  // Particles
  for(let i=particles.length-1;i>=0;i--){
    const p=particles[i];
    const d60=dt*60;p.x+=p.vx*d60;p.y+=p.vy*d60;p.vx*=Math.pow(0.98,d60);p.vy*=Math.pow(0.98,d60);p.life-=dt*1.2;
    if(p.life<=0){particles.splice(i,1);continue}
    ctx.globalAlpha=p.life;ctx.fillStyle=p.color;
    ctx.beginPath();ctx.arc(p.x,p.y,p.size*p.life,0,Math.PI*2);ctx.fill();
    ctx.globalAlpha=1;
  }
}
requestAnimationFrame(draw);
</script>
</body>
</html>
